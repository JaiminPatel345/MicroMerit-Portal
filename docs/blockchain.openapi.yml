openapi: 3.0.3
info:
  title: MicroMerit Portal - Blockchain Integration API
  description: |
    Blockchain integration for credential verification and immutability.
    
    ## Status: Placeholder Implementation
    This module is currently a placeholder with mock functionality.
    It will be replaced with actual blockchain integration in future releases.
    
    ## Features
    - Record credential hashes on blockchain
    - Retrieve blockchain transaction details
    - Link credentials to immutable blockchain records
    - Support for multiple blockchain networks
    
    ## Future Implementation
    - Ethereum smart contract integration
    - Polygon/L2 support for lower gas fees
    - IPFS storage for credential metadata
    - Merkle tree batching for cost optimization
  version: 1.0.0-placeholder
  contact:
    name: MicroMerit Portal Team
    email: support@micromerit.com

servers:
  - url: http://localhost:3000/api
    description: Development server
  - url: https://api.micromerit.com/api
    description: Production server

tags:
  - name: Blockchain Records
    description: Blockchain recording and verification (placeholder)

paths:
  /blockchain/record:
    post:
      tags:
        - Blockchain Records
      summary: Record credential on blockchain
      description: |
        Record a credential hash on the blockchain.
        
        **Current Implementation**: Returns mock transaction hash.
        **Future Implementation**: Will submit actual blockchain transaction.
        
        This endpoint is automatically called when a credential is issued.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - credential_uid
                - data_hash
              properties:
                credential_uid:
                  type: string
                  example: CRED-550e8400-e29b-41d4-a716-446655440000
                data_hash:
                  type: string
                  example: 0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef
                  description: SHA-256 hash of credential data
                blockchain_network:
                  type: string
                  enum: [Ethereum, Polygon, Binance Smart Chain]
                  default: Ethereum
                  example: Ethereum
      responses:
        '201':
          description: Blockchain record created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Credential recorded on blockchain
                  data:
                    $ref: '#/components/schemas/BlockchainRecord'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /blockchain/verify/{credential_uid}:
    get:
      tags:
        - Blockchain Records
      summary: Verify blockchain record
      description: |
        Verify that a credential exists on the blockchain.
        
        **Current Implementation**: Returns mock verification data.
        **Future Implementation**: Will query actual blockchain.
      parameters:
        - name: credential_uid
          in: path
          required: true
          schema:
            type: string
          example: CRED-550e8400-e29b-41d4-a716-446655440000
      responses:
        '200':
          description: Blockchain verification result
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Blockchain verification completed
                  data:
                    allOf:
                      - $ref: '#/components/schemas/BlockchainRecord'
                      - type: object
                        properties:
                          verification:
                            type: object
                            properties:
                              exists_on_chain:
                                type: boolean
                                example: true
                              confirmations:
                                type: integer
                                example: 12
                                description: Number of block confirmations
                              block_number:
                                type: integer
                                example: 15234567
                              block_timestamp:
                                type: string
                                format: date-time
        '404':
          $ref: '#/components/responses/NotFoundError'

  /blockchain/transaction/{transaction_hash}:
    get:
      tags:
        - Blockchain Records
      summary: Get transaction details
      description: |
        Get blockchain transaction details by transaction hash.
        
        **Current Implementation**: Returns mock transaction data.
        **Future Implementation**: Will query blockchain explorer API.
      parameters:
        - name: transaction_hash
          in: path
          required: true
          schema:
            type: string
          example: '0xabc123def456...'
      responses:
        '200':
          description: Transaction details retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Transaction details retrieved
                  data:
                    type: object
                    properties:
                      transaction_hash:
                        type: string
                        example: '0xabc123def456...'
                      blockchain_network:
                        type: string
                        example: Ethereum
                      block_number:
                        type: integer
                        example: 15234567
                      timestamp:
                        type: string
                        format: date-time
                      gas_used:
                        type: string
                        example: '21000'
                      gas_price:
                        type: string
                        example: '50 Gwei'
                      status:
                        type: string
                        enum: [success, pending, failed]
                        example: success
                      explorer_url:
                        type: string
                        format: uri
                        example: https://etherscan.io/tx/0xabc123def456...
        '404':
          $ref: '#/components/responses/NotFoundError'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token for issuer authentication

  schemas:
    BlockchainRecord:
      type: object
      properties:
        id:
          type: integer
          example: 1
        credential_id:
          type: integer
          example: 5
        credential_uid:
          type: string
          example: CRED-550e8400-e29b-41d4-a716-446655440000
        transaction_hash:
          type: string
          example: '0xabc123def456789012345678901234567890abcdef123456789012345678901234'
          description: Blockchain transaction hash
        blockchain_network:
          type: string
          example: Ethereum
          description: Blockchain network name
        data_hash:
          type: string
          example: '0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef'
          description: SHA-256 hash of credential data
        recorded_at:
          type: string
          format: date-time
          example: '2024-01-15T10:30:00Z'
        explorer_url:
          type: string
          format: uri
          example: https://etherscan.io/tx/0xabc123def456...
          description: Link to blockchain explorer

    Error:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: An error occurred

  responses:
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            message: Validation error

    UnauthorizedError:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            message: Authentication required

    NotFoundError:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            message: Blockchain record not found
